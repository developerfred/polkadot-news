{"version":3,"file":"bounty-descriptions.mjs","sources":["../../../src/bounties/bounty-descriptions.ts"],"sourcesContent":["import { KeyChanges } from \"@react-rxjs/utils\"\nimport { Binary } from \"polkadot-api\"\nimport {\n  defer,\n  merge,\n  mergeMap,\n  Observable,\n  scan,\n  shareReplay,\n  skip,\n  startWith,\n} from \"rxjs\"\n\nexport const getBountyDescriptions$ = (\n  getEntries: () => Promise<\n    {\n      keyArgs: [Key: number]\n      value: Binary\n    }[]\n  >,\n  getValues: (keys: [number][]) => Promise<(Binary | undefined)[]>,\n  keyChanges$: Observable<KeyChanges<number>>,\n) =>\n  merge(\n    defer(getEntries),\n    keyChanges$.pipe(\n      skip(1),\n      mergeMap((changes) => {\n        if (changes.type === \"remove\") return []\n        const keys = Array.from(changes.keys)\n        return getValues(keys.map((key) => [key])).then((result) =>\n          result\n            .map((value, i) => ({\n              keyArgs: [keys[i]] as [Key: number],\n              value: value!,\n            }))\n            .filter(({ value }) => value != null),\n        )\n      }),\n    ),\n  ).pipe(\n    scan(\n      (acc, v) => ({\n        ...acc,\n        ...Object.fromEntries(\n          v.map(({ keyArgs, value }) => [keyArgs[0], value.asText()]),\n        ),\n      }),\n      {} as Record<number, string>,\n    ),\n    startWith({} as Record<number, string>),\n    shareReplay({ bufferSize: 1, refCount: true }),\n  )\n"],"names":[],"mappings":";;AAaO,MAAM,sBAAyB,GAAA,CACpC,UAMA,EAAA,SAAA,EACA,WAEA,KAAA,KAAA;AAAA,EACE,MAAM,UAAU,CAAA;AAAA,EAChB,WAAY,CAAA,IAAA;AAAA,IACV,KAAK,CAAC,CAAA;AAAA,IACN,QAAA,CAAS,CAAC,OAAY,KAAA;AACpB,MAAA,IAAI,OAAQ,CAAA,IAAA,KAAS,QAAU,EAAA,OAAO,EAAC;AACvC,MAAA,MAAM,IAAO,GAAA,KAAA,CAAM,IAAK,CAAA,OAAA,CAAQ,IAAI,CAAA;AACpC,MAAO,OAAA,SAAA,CAAU,KAAK,GAAI,CAAA,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAE,CAAA,IAAA;AAAA,QAAK,CAAC,MAC/C,KAAA,MAAA,CACG,GAAI,CAAA,CAAC,OAAO,CAAO,MAAA;AAAA,UAClB,OAAS,EAAA,CAAC,IAAK,CAAA,CAAC,CAAC,CAAA;AAAA,UACjB;AAAA,SACF,CAAE,EACD,MAAO,CAAA,CAAC,EAAE,KAAM,EAAA,KAAM,SAAS,IAAI;AAAA,OACxC;AAAA,KACD;AAAA;AAEL,CAAE,CAAA,IAAA;AAAA,EACA,IAAA;AAAA,IACE,CAAC,KAAK,CAAO,MAAA;AAAA,MACX,GAAG,GAAA;AAAA,MACH,GAAG,MAAO,CAAA,WAAA;AAAA,QACR,CAAE,CAAA,GAAA,CAAI,CAAC,EAAE,SAAS,KAAM,EAAA,KAAM,CAAC,OAAA,CAAQ,CAAC,CAAA,EAAG,KAAM,CAAA,MAAA,EAAQ,CAAC;AAAA;AAC5D,KACF,CAAA;AAAA,IACA;AAAC,GACH;AAAA,EACA,SAAA,CAAU,EAA4B,CAAA;AAAA,EACtC,YAAY,EAAE,UAAA,EAAY,CAAG,EAAA,QAAA,EAAU,MAAM;AAC/C;;;;"}