import { partitionByKey } from '@react-rxjs/utils';
import { mergeMap, takeWhile, map } from 'rxjs';

function partitionEntries(entries$) {
  return partitionByKey(
    entries$.pipe(
      mergeMap(
        (v) => v.deltas ? [
          ...v.deltas.deleted.map((d) => ({
            id: d.args.at(-1),
            value: void 0
          })),
          ...v.deltas.upserted.map((d) => ({
            id: d.args.at(-1),
            value: d.value
          }))
        ].sort((a, b) => a.id - b.id) : []
      )
    ),
    (res) => res.id,
    (group$) => group$.pipe(
      takeWhile(({ value }) => Boolean(value), false),
      map(({ value }) => value)
    )
  );
}

export { partitionEntries };
//# sourceMappingURL=watchEntries.mjs.map
